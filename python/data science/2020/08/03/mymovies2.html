<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Analysing the movies I&#39;ve watched, Part II, Data cleaning</h1><p class="page-description">I briefly describe the tidying that I did.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-08-03T00:00:00-05:00" itemprop="datePublished">
        Aug 3, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#data science">data science</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#other-posts-in-series">Other posts in series</a></li>
<li class="toc-entry toc-h2"><a href="#fixing-bad-indexing">Fixing bad indexing</a></li>
<li class="toc-entry toc-h2"><a href="#creating-datetime-column">Creating datetime column</a></li>
<li class="toc-entry toc-h2"><a href="#tidying-the-source-column">Tidying the source column</a></li>
<li class="toc-entry toc-h2"><a href="#tidying-the-other-column">Tidying the other column</a></li>
<li class="toc-entry toc-h2"><a href="#tidying-the-title-column">Tidying the title column</a></li>
<li class="toc-entry toc-h2"><a href="#conclusion">Conclusion</a></li>
</ul><h2 id="other-posts-in-series">
<a class="anchor" href="#other-posts-in-series" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other posts in series</h2>

<ul>
  <li>
    <p><a href="/blog/python/data%20science/2020/09/02/mymovies5.html">Analysing the movies I’ve watched, Part V, Data visualisation II</a></p>
  </li>
  <li>
    <p><a href="/blog/python/data%20science/2020/08/24/mymovies4.html">Analysing the movies I’ve watched, Part IV, Data visualisation</a></p>
  </li>
  <li>
    <p><a href="/blog/python/data%20science/2020/08/19/mymovies3.html">Analysing the movies I’ve watched, Part III, Joining the tables</a></p>
  </li>
  <li>
    <p><a href="/blog/python/data%20science/2020/08/02/mymovies1.html">Analysing the movies I’ve watched, Part I, Data collection</a></p>
  </li>
</ul>

<h2 id="fixing-bad-indexing">
<a class="anchor" href="#fixing-bad-indexing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fixing bad indexing</h2>
<p>One of the columns is an index to show how many movies I have watched since I started the record. This was mostly accurate, except for reasons unknown to me, the latest records went through the indices 670 to 679 a few times; instead of an index changing from 679 to 680, I would go back to 670.  So, I wrote some code to fix this.</p>

<h2 id="creating-datetime-column">
<a class="anchor" href="#creating-datetime-column" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating datetime column</h2>
<p>One of the columns has year, and another column has date formatted as a string “DD Mon” (e.g. <code class="highlighter-rouge">1 Jan</code>). I wanted to combine these to create a column with datetime type, and “yyyy-mm-dd” format. I first tidied the month column (some months had multiple entries, e.g. <code class="highlighter-rouge">Jun</code> and <code class="highlighter-rouge">June</code>), and sometimes other data was in the month column (e.g. <code class="highlighter-rouge">#recc</code>), so I fixed those.  Then I tidied the date column - I padded out the digits so they were always two strings long.  Once it was all tidy, I created the new column:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'datetime'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">+</span><span class="s">' '</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">month</span><span class="o">+</span><span class="s">' '</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                               <span class="n">errors</span> <span class="o">=</span> <span class="s">'coerce'</span><span class="p">,</span>
                               <span class="nb">format</span> <span class="o">=</span> <span class="s">'</span><span class="si">%</span><span class="s">Y </span><span class="si">%</span><span class="s">b </span><span class="si">%</span><span class="s">d'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="tidying-the-source-column">
<a class="anchor" href="#tidying-the-source-column" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tidying the source column</h2>
<p>There is a column called “source”, which contains information on where I watched the movie, e.g. Netflix, cinema, TV, etc. Tidying this required a lot of manual work, because there were various different sources that I wanted to deal with in different ways. E.g. sometimes the source was the name of a friend (e.g. I watched a movie at their house), and so I wanted to replace source with friend, and move the friend’s name to the <code class="highlighter-rouge">Other</code> column. In retrospect, I could have made the process a bit more automated. But what is done is done, I suppose.</p>

<h2 id="tidying-the-other-column">
<a class="anchor" href="#tidying-the-other-column" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tidying the other column</h2>
<p>There is a column called “other” to contain miscellaneous information. This required no cleaning, which is nice!</p>

<h2 id="tidying-the-title-column">
<a class="anchor" href="#tidying-the-title-column" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tidying the title column</h2>
<p>I anticipate joining this table with an <code class="highlighter-rouge">imdb</code> dataset, so I can get information like ratings, director, movie length, that might be fun to include in my analysis. I downloaded the <code class="highlighter-rouge">title.basics.tsv</code> dataset, then read it into a dataframe, keeping only the columns <code class="highlighter-rouge">tconst</code>, <code class="highlighter-rouge">primaryTitle</code> and <code class="highlighter-rouge">startYear</code>. I converted all the primaryTitles to lowercase.</p>

<p>Next I created a column in my dataframe to say whether the title in my records occurs in the imdb dataset.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">imdb_titles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">imdb</span><span class="o">.</span><span class="n">primaryTitle</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'title_in_imdb'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">movie_title</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">imdb_titles</span><span class="p">)</span>
</code></pre></div></div>

<p>Doing a little check reveals that 549 of the entries are fine, but 147 are not. So, I bite the bullet and go into another batch of manual corrections. I anticipate their being various reasons why the title would not work, so try to make the process as flexible as possible. I create the following function to make it easy to update a specific row, then loop through the values which were not in the imdb database.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">update_row</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="n">new_title</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"title: "</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s">'movie_title'</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_title</span>
    <span class="n">new_other</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"other: "</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new_other</span> <span class="o">!=</span> <span class="s">""</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s">'other'</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_other</span>
    <span class="k">return</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">'{index}. {row[1]};    {row[-3]}'</span><span class="p">)</span>
        <span class="n">update_row</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'third_tidy.csv'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="conclusion">
<a class="anchor" href="#conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion</h2>
<p>This was a considerable effort, with a lot of manual grinding. I am curious to know what would happen in a commerical context with millions of entries, with a similar hodge-podge of bad data. I presume there must be more efficient ways of tidying, but maybe you really do just have to get your hands dirty if the data is messy enough.</p>

  </div><a class="u-url" href="/blog/python/data%20science/2020/08/03/mymovies2.html" hidden></a>
</article>