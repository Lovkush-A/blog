<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Bacon numbers via Recursive SQL | Lovkush Agarwal</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Bacon numbers via Recursive SQL" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I create a table of actors and their bacon numbers using recursion in SQL. The largest finite bacon number is 13." />
<meta property="og:description" content="I create a table of actors and their bacon numbers using recursion in SQL. The largest finite bacon number is 13." />
<link rel="canonical" href="https://lovkush-a.github.io/blog/sql/python/2020/05/24/recursion_sql.html" />
<meta property="og:url" content="https://lovkush-a.github.io/blog/sql/python/2020/05/24/recursion_sql.html" />
<meta property="og:site_name" content="Lovkush Agarwal" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-24T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"I create a table of actors and their bacon numbers using recursion in SQL. The largest finite bacon number is 13.","headline":"Bacon numbers via Recursive SQL","dateModified":"2020-05-24T00:00:00-05:00","datePublished":"2020-05-24T00:00:00-05:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://lovkush-a.github.io/blog/sql/python/2020/05/24/recursion_sql.html"},"url":"https://lovkush-a.github.io/blog/sql/python/2020/05/24/recursion_sql.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://lovkush-a.github.io/blog/feed.xml" title="Lovkush Agarwal" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-29327017-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>





<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Bacon numbers via Recursive SQL | Lovkush Agarwal</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Bacon numbers via Recursive SQL" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I create a table of actors and their bacon numbers using recursion in SQL. The largest finite bacon number is 13." />
<meta property="og:description" content="I create a table of actors and their bacon numbers using recursion in SQL. The largest finite bacon number is 13." />
<link rel="canonical" href="https://lovkush-a.github.io/blog/sql/python/2020/05/24/recursion_sql.html" />
<meta property="og:url" content="https://lovkush-a.github.io/blog/sql/python/2020/05/24/recursion_sql.html" />
<meta property="og:site_name" content="Lovkush Agarwal" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-24T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"I create a table of actors and their bacon numbers using recursion in SQL. The largest finite bacon number is 13.","headline":"Bacon numbers via Recursive SQL","dateModified":"2020-05-24T00:00:00-05:00","datePublished":"2020-05-24T00:00:00-05:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://lovkush-a.github.io/blog/sql/python/2020/05/24/recursion_sql.html"},"url":"https://lovkush-a.github.io/blog/sql/python/2020/05/24/recursion_sql.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://lovkush-a.github.io/blog/feed.xml" title="Lovkush Agarwal" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-29327017-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Lovkush Agarwal</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Bacon numbers via Recursive SQL</h1><p class="page-description">I create a table of actors and their bacon numbers using recursion in SQL. The largest finite bacon number is 13.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-05-24T00:00:00-05:00" itemprop="datePublished">
        May 24, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#sql">sql</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#python">python</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#sql-in-python">SQL in Python</a></li>
<li class="toc-entry toc-h2"><a href="#understanding-the-database">Understanding the database</a></li>
<li class="toc-entry toc-h2"><a href="#the-recursive-query">The recursive query</a></li>
<li class="toc-entry toc-h2"><a href="#bacon-number-of-13">Bacon number of 13</a></li>
</ul><h2 id="sql-in-python">
<a class="anchor" href="#sql-in-python" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQL in Python</h2>
<p>I ran the SQL commands in Python using the module sqlite3. I used <a href="https://swcarpentry.github.io/sql-novice-survey/10-prog/index.html">this article</a> to help me set it all up. Below is the code to run queries on the database <em>movies.db</em> in python.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">import</span> <span class="nn">sqlite3</span>

    <span class="k">def</span> <span class="nf">run_sql</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'movies.db'</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></div>

<h2 id="understanding-the-database">
<a class="anchor" href="#understanding-the-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Understanding the database</h2>
<p>The data is in the form of a database, <em>movies.db</em>, and was obtained from the online course <a href="https://cs50.harvard.edu/x/2020/psets/7/movies/">CS50</a>, which in turn was obtained from imdb. To find out the structure of the tables in the database, I ran the following code (obtained from <a href="https://stackoverflow.com/questions/305378/list-of-tables-db-schema-dump-etc-using-the-python-sqlite3-api">stackoverflow</a>).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">produce_schema</span><span class="p">():</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT name FROM sqlite_master WHERE type = 'table';"</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="n">run_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
    
        <span class="n">schema</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="n">f</span><span class="s">"SELECT sql FROM sqlite_master WHERE type = 'table' and name = '{table[0]}'"</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">run_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">schema</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    
        <span class="k">return</span> <span class="n">schema</span>

    <span class="n">produce_schema</span><span class="p">()</span>
</code></pre></div></div>

<p>For the task of determining bacon numbers, the relevant tables and columns are:</p>
<ul>
  <li>
<code class="highlighter-rouge">people</code>, with columns <code class="highlighter-rouge">id</code> and <code class="highlighter-rouge">name</code>. Each person has a unique id. There are 1044499 people in the table.</li>
  <li>
<code class="highlighter-rouge">stars</code>, with columns <code class="highlighter-rouge">movie_id</code> and <code class="highlighter-rouge">person_id</code>. Each row tells you that the actor with id <code class="highlighter-rouge">person_id</code> starred in the movie with id <code class="highlighter-rouge">movie_id</code>.</li>
</ul>

<p>Kevin Bacon has an id of 102, found by running the query <code class="highlighter-rouge">SELECT id FROM people WHERE name = 'Kevin Bacon' </code></p>

<h2 id="the-recursive-query">
<a class="anchor" href="#the-recursive-query" aria-hidden="true"><span class="octicon octicon-link"></span></a>The recursive query</h2>
<p>To understand recursion in SQL, I recommend <a href="https://www.essentialsql.com/recursive-ctes-explained/">this guide</a> which explains recursion and how to use recursion in SQL, and then the <a href="https://www.sqlite.org/lang_with.html">SQLite documentation</a> to better understand some implementation details and what options are available to you.</p>

<p>The query I created to produce the table of bacon numbers is:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">WITH</span> <span class="k">RECURSIVE</span>
     <span class="n">costars</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">)</span> <span class="k">AS</span>
     <span class="p">(</span> 
       <span class="k">SELECT</span> <span class="n">stars1</span><span class="p">.</span><span class="n">person_id</span><span class="p">,</span> <span class="n">stars2</span><span class="p">.</span><span class="n">person_id</span>
       <span class="k">FROM</span> <span class="n">stars</span> <span class="k">AS</span> <span class="n">stars1</span>
       <span class="k">JOIN</span> <span class="n">stars</span> <span class="k">AS</span> <span class="n">stars2</span>
       <span class="k">ON</span> <span class="n">stars1</span><span class="p">.</span><span class="n">movie_id</span> <span class="o">=</span> <span class="n">stars2</span><span class="p">.</span><span class="n">movie_id</span>
     <span class="p">),</span>
     <span class="n">bacon</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="k">AS</span>
     <span class="p">(</span>
       <span class="k">VALUES</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
       <span class="k">UNION</span>
       <span class="k">SELECT</span> <span class="n">id2</span><span class="p">,</span> <span class="n">num</span><span class="o">+</span><span class="mi">1</span>
       <span class="k">FROM</span> <span class="n">bacon</span> <span class="k">JOIN</span> <span class="n">costars</span>
       <span class="k">ON</span> <span class="n">bacon</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">costars</span><span class="p">.</span><span class="n">id1</span>
       <span class="k">WHERE</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">13</span>
     <span class="p">)</span>
     <span class="k">SELECT</span> <span class="n">bacon</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="k">MIN</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
     <span class="k">FROM</span> <span class="n">bacon</span> <span class="k">JOIN</span> <span class="n">people</span> <span class="k">ON</span> <span class="n">bacon</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">people</span><span class="p">.</span><span class="n">id</span>
     <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">bacon</span><span class="p">.</span><span class="n">id</span>
     <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">num</span>
</code></pre></div></div>

<ul>
  <li>The table <code class="highlighter-rouge">costars</code> lists all pairs of actors that co-starred in a movie. This is obtained by doing a self-join of the stars table.</li>
  <li>The table <code class="highlighter-rouge">bacon</code> is the main table. <code class="highlighter-rouge">id</code> is the id of the actor and <code class="highlighter-rouge">num</code> is the bacon number.
    <ul>
      <li>It starts off with the entry <code class="highlighter-rouge">(102,0)</code>.  102 is Kevin Bacon’s id and 0 is Kevin Bacon’s Bacon number.</li>
      <li>Then for any entry <code class="highlighter-rouge">(id, num)</code> already in the table, we add a new row <code class="highlighter-rouge">(id2, num+1)</code>, whenever <code class="highlighter-rouge">id2</code> co-starred with <code class="highlighter-rouge">id</code>.</li>
      <li>
<code class="highlighter-rouge">num &lt; 13</code> indicates we will only have a maximum bacon number of 13. Without this manual limit, the recursive query would never end. This is because the underlying data is not acyclic: e.g. if a is a co-star with b, then b is a co-star of a. The number 13 was chosen via trial-and-error. The resulting table does not change if I increase the limit further, which implies that the maximum bacon number is 13.</li>
    </ul>
  </li>
  <li>In the end, I select the relevant data from this recursive construction. Because each actor can appear many times in this construction, I use <code class="highlighter-rouge">GROUP BY</code> to ensure each actor appears only once. I use <code class="highlighter-rouge">MIN(num)</code> to select each actor’s earliest appearance.</li>
</ul>

<p>The two main problems with this query are that:</p>
<ul>
  <li>It is inefficient. There is huge redundancy as actors appear many times in the recursive construction. I do not think there is a way of avoiding this within SQL.</li>
  <li>I have to know what the maximum Bacon number is for the query to produce a complete list. I found this using trial-and-error.</li>
</ul>

<h2 id="bacon-number-of-13">
<a class="anchor" href="#bacon-number-of-13" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bacon number of 13</h2>
<p>By running a simple query, I find there are two people with the maximum bacon number of 13, Javier Ordonez and Kimberly Peters.  Using the program created for <a href="https://cs50.harvard.edu/ai/2020/projects/0/degrees/">this CS50 AI</a> project, I could find the path from these actors to Kevin Bacon. As expected, it takes 13 steps (always satisfying to see two different programs being consistent!) and they are below. Note they have the same path.</p>

<ol>
  <li>Javier Ordonez/Kimberly Peters and Amanda Brass starred in PRND</li>
  <li>Amanda Brass and Michael Bayouth starred in Park Reverse Neutral Drive, PRND (Director’s cut)</li>
  <li>Michael Bayouth and Brandy Bourdeaux starred in Grease Trek</li>
  <li>Brandy Bourdeaux and Kim Beuché starred in Murder Inside of Me</li>
  <li>Kim Beuché and Ed Baccari starred in Island, Alicia</li>
  <li>Ed Baccari and Aida Angotti starred in Late Watch</li>
  <li>Aida Angotti and Lamont Copeland starred in Bottom Out</li>
  <li>Lamont Copeland and Ashley Marie Arnold starred in Eye Was Blind</li>
  <li>Ashley Marie Arnold and Sid Bernstein starred in The Rodnees: We Mod Like Dat!</li>
  <li>Sid Bernstein and Chuck Berry starred in The Beatles: The Lost Concert</li>
  <li>Chuck Berry and Eric Clapton starred in Chuck Berry Hail! Hail! Rock ‘n’ Roll</li>
  <li>Eric Clapton and Tom Cruise starred in Close Up</li>
  <li>Tom Cruise and Kevin Bacon starred in A Few Good Men</li>
</ol>


  </div><a class="u-url" href="/blog/sql/python/2020/05/24/recursion_sql.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A blog for my data science learning and projects</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/lovkush-a" target="_blank" title="lovkush-a"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/lovkushatleeds" target="_blank" title="lovkushatleeds"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
